<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Dashboard de Estoque</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .company-logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 28px;
            font-weight: bold;
            color: #1F448C;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #1F448C 0%, #3366CC 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
        }
        
        .setup-steps {
            margin: 30px 0;
        }
        
        .step {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .step.active {
            border-color: #1F448C;
            background: #f8f9ff;
        }
        
        .step.completed {
            border-color: #4CAF50;
            background: #f1f8e9;
        }
        
        .step.error {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .step-number {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
        }
        
        .step.active .step-number {
            background: #1F448C;
        }
        
        .step.completed .step-number {
            background: #4CAF50;
        }
        
        .step.error .step-number {
            background: #f44336;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .step-description {
            color: #666;
            margin: 0 0 15px 0;
            line-height: 1.5;
        }
        
        .step-status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            font-size: 14px;
        }
        
        .status-waiting {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-running {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .test-results {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .test-name {
            font-weight: 500;
        }
        
        .test-result {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .test-pass {
            background: #d4edda;
            color: #155724;
        }
        
        .test-fail {
            background: #f8d7da;
            color: #721c24;
        }
        
        .test-warn {
            background: #fff3cd;
            color: #856404;
        }
        
        .actions {
            text-align: center;
            margin: 30px 0;
        }
        
        button {
            background: linear-gradient(135deg, #1F448C 0%, #3366CC 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(31, 68, 140, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(31, 68, 140, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1F448C 0%, #3366CC 100%);
            border-radius: 5px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .final-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 15px;
            margin: 30px 0;
            display: none;
        }
        
        .final-message h2 {
            color: #155724;
            margin: 0 0 15px 0;
        }
        
        .final-message p {
            color: #155724;
            margin: 10px 0;
            font-size: 16px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .step.active {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="company-logo">
                <div class="logo-icon">U</div>
                <span>USIQU√çMICA</span>
            </div>
            <h1>üöÄ Instalador do Dashboard de Estoque</h1>
            <p>Configure seu sistema de controle de estoque em poucos passos</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="setup-steps" id="setupSteps">
            <div class="step" id="step1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Verifica√ß√£o do Ambiente</div>
                    <div class="step-description">Testando compatibilidade do navegador e recursos necess√°rios</div>
                    <div class="step-status status-waiting" id="status1">Aguardando...</div>
                </div>
            </div>

            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Verifica√ß√£o de Arquivos</div>
                    <div class="step-description">Confirmando presen√ßa dos arquivos necess√°rios</div>
                    <div class="step-status status-waiting" id="status2">Aguardando...</div>
                </div>
            </div>

            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Teste de Funcionalidades</div>
                    <div class="step-description">Verificando se todos os recursos est√£o funcionando</div>
                    <div class="step-status status-waiting" id="status3">Aguardando...</div>
                </div>
            </div>

            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">Configura√ß√£o Inicial</div>
                    <div class="step-description">Carregando dados de exemplo e finalizando setup</div>
                    <div class="step-status status-waiting" id="status4">Aguardando...</div>
                </div>
            </div>
        </div>

        <div class="test-results" id="testResults" style="display: none;">
            <h3>üìã Resultados dos Testes</h3>
            <div id="testList"></div>
        </div>

        <div class="actions">
            <button id="startSetup" onclick="startSetup()">üöÄ Iniciar Instala√ß√£o</button>
            <button id="openDashboard" onclick="openDashboard()" style="display: none;" class="btn-secondary">üìä Abrir Dashboard</button>
            <button id="downloadFiles" onclick="showDownloadInstructions()" style="display: none;">üìÅ Baixar Arquivos</button>
        </div>

        <div class="final-message" id="finalMessage">
            <h2>üéâ Instala√ß√£o Conclu√≠da com Sucesso!</h2>
            <p>Seu Dashboard de Estoque est√° pronto para uso.</p>
            <p>Voc√™ j√° pode importar suas planilhas e compartilhar com sua equipe.</p>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let tests = [];

        function updateProgress() {
            const progress = (currentStep / 4) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function setStepStatus(stepNum, status, message) {
            const step = document.getElementById(`step${stepNum}`);
            const statusEl = document.getElementById(`status${stepNum}`);
            
            step.className = `step ${status}`;
            statusEl.className = `step-status status-${status}`;
            statusEl.textContent = message;
        }

        function addTest(name, result, message = '') {
            tests.push({ name, result, message });
        }

        function showTestResults() {
            const testResults = document.getElementById('testResults');
            const testList = document.getElementById('testList');
            
            testList.innerHTML = '';
            tests.forEach(test => {
                const testItem = document.createElement('div');
                testItem.className = 'test-item';
                
                const resultClass = test.result === 'pass' ? 'test-pass' : 
                                  test.result === 'warn' ? 'test-warn' : 'test-fail';
                
                const resultText = test.result === 'pass' ? '‚úÖ Passou' : 
                                 test.result === 'warn' ? '‚ö†Ô∏è Aviso' : '‚ùå Falhou';
                
                testItem.innerHTML = `
                    <span class="test-name">${test.name}</span>
                    <span class="test-result ${resultClass}">${resultText}</span>
                `;
                
                testList.appendChild(testItem);
            });
            
            testResults.style.display = 'block';
        }

        async function startSetup() {
            document.getElementById('startSetup').disabled = true;
            currentStep = 1;
            updateProgress();
            
            // Passo 1: Verifica√ß√£o do Ambiente
            setStepStatus(1, 'active', 'Verificando...');
            await sleep(1000);
            
            try {
                // Teste do navegador
                const userAgent = navigator.userAgent;
                const isModernBrowser = 'fetch' in window && 'localStorage' in window;
                addTest('Navegador Moderno', isModernBrowser ? 'pass' : 'fail');
                
                // Teste de APIs necess√°rias
                const hasFileReader = 'FileReader' in window;
                addTest('File Reader API', hasFileReader ? 'pass' : 'fail');
                
                const hasCanvas = 'HTMLCanvasElement' in window;
                addTest('Canvas Support', hasCanvas ? 'pass' : 'fail');
                
                const hasLocalStorage = typeof(Storage) !== 'undefined';
                addTest('Local Storage', hasLocalStorage ? 'pass' : 'warn');
                
                setStepStatus(1, 'completed', 'Ambiente verificado ‚úÖ');
                currentStep = 2;
                updateProgress();
                
                // Passo 2: Verifica√ß√£o de Arquivos
                setStepStatus(2, 'active', 'Verificando arquivos...');
                await sleep(1000);
                
                // Verificar se consegue carregar bibliotecas
                let xlsxLoaded = false;
                try {
                    if (typeof XLSX !== 'undefined') {
                        xlsxLoaded = true;
                    }
                } catch (e) {
                    // Tentar carregar dinamicamente
                    await loadXLSX();
                    xlsxLoaded = typeof XLSX !== 'undefined';
                }
                addTest('Biblioteca XLSX', xlsxLoaded ? 'pass' : 'warn');
                
                // Verificar data.js
                const hasStockData = typeof window.stockData !== 'undefined';
                addTest('Arquivo data.js', hasStockData ? 'pass' : 'warn');
                
                setStepStatus(2, 'completed', 'Arquivos verificados ‚úÖ');
                currentStep = 3;
                updateProgress();
                
                // Passo 3: Teste de Funcionalidades
                setStepStatus(3, 'active', 'Testando funcionalidades...');
                await sleep(1000);
                
                // Teste de cria√ß√£o de elementos
                const canCreateElements = document.createElement('div') !== null;
                addTest('Manipula√ß√£o DOM', canCreateElements ? 'pass' : 'fail');
                
                // Teste de JSON
                const canUseJSON = JSON && JSON.parse && JSON.stringify;
                addTest('Suporte JSON', canUseJSON ? 'pass' : 'fail');
                
                // Teste de canvas
                let canDrawCanvas = false;
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.fillRect(0, 0, 1, 1);
                        canDrawCanvas = true;
                    }
                } catch (e) {}
                addTest('Desenho Canvas', canDrawCanvas ? 'pass' : 'warn');
                
                setStepStatus(3, 'completed', 'Funcionalidades testadas ‚úÖ');
                currentStep = 4;
                updateProgress();
                
                // Passo 4: Configura√ß√£o Inicial
                setStepStatus(4, 'active', 'Configurando...');
                await sleep(1000);
                
                // Carregar dados de exemplo se necess√°rio
                if (!hasStockData) {
                    window.stockData = [
                        {
                            code: "EXEMPLO.001",
                            supplier: "FORNECEDOR TESTE",
                            family: "FAM√çLIA EXEMPLO",
                            item: "PRODUTO DE TESTE",
                            stock14: 100,
                            stock9013: 50,
                            stock9015: 25,
                            stockMonths: 2.5
                        }
                    ];
                    addTest('Dados de Exemplo', 'pass');
                } else {
                    addTest('Dados Existentes', 'pass');
                }
                
                // Salvar no localStorage
                if (hasLocalStorage) {
                    try {
                        localStorage.setItem('dashboardSetupComplete', 'true');
                        localStorage.setItem('setupDate', new Date().toISOString());
                        addTest('Configura√ß√£o Salva', 'pass');
                    } catch (e) {
                        addTest('Configura√ß√£o Salva', 'warn');
                    }
                }
                
                setStepStatus(4, 'completed', 'Configura√ß√£o conclu√≠da ‚úÖ');
                currentStep = 5;
                updateProgress();
                
                // Finalizar
                showTestResults();
                document.getElementById('finalMessage').style.display = 'block';
                document.getElementById('openDashboard').style.display = 'inline-block';
                
                // Verificar se tem todos os arquivos
                const allFilesPresent = xlsxLoaded && hasStockData;
                if (!allFilesPresent) {
                    document.getElementById('downloadFiles').style.display = 'inline-block';
                }
                
            } catch (error) {
                setStepStatus(currentStep, 'error', 'Erro: ' + error.message);
                addTest('Instala√ß√£o', 'fail', error.message);
                showTestResults();
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function loadXLSX() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        function openDashboard() {
            window.open('index.html', '_blank');
        }

        function showDownloadInstructions() {
            alert(`üìÅ Arquivos Necess√°rios:

1. index.html - Dashboard principal
2. data.js - Arquivo de dados
3. config.js - Configura√ß√µes (opcional)
4. template.html - Gerador de templates (opcional)
5. guia-rapido.html - Guia de refer√™ncia (opcional)

Certifique-se de que todos est√£o na mesma pasta e tente novamente.`);
        }

        // Verificar se j√° foi instalado
        window.addEventListener('load', function() {
            const setupComplete = localStorage.getItem('dashboardSetupComplete');
            if (setupComplete) {
                document.getElementById('openDashboard').style.display = 'inline-block';
                
                const setupDate = localStorage.getItem('setupDate');
                if (setupDate) {
                    const date = new Date(setupDate).toLocaleDateString('pt-BR');
                    document.querySelector('.header p').textContent = `√öltima instala√ß√£o: ${date}`;
                }
            }
        });
    </script>
</body>
</html>